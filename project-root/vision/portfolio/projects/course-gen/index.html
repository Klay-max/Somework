<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能课程架构师 - 安俭钊的作品</title>
    <link rel="stylesheet" href="../../assets/global.css">
    <link rel="stylesheet" href="../../assets/navbar.css">
    <style>
      :root { --bg-color: #0a0a0a; --text-primary: #ffffff; --text-secondary: #c2c2c2; --border-color: #2a2a2a; --accent-color: #6366f1; --accent-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); --card-bg: rgba(255,255,255,0.05); --hover-bg: rgba(255,255,255,0.08); --nav-bg: rgba(10,10,10,0.35); --nav-border: rgba(255,255,255,0.08); --nav-text: #ffffff; }
      body { background: var(--bg-color); color: var(--text-primary); font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
      .navbar { backdrop-filter: blur(10px); }
      .page { max-width: 1100px; margin: 100px auto 60px; padding: 0 24px; }
      .hero { margin-bottom: 24px; }
      .hero h1 { font-family: 'Playfair Display', serif; font-size: clamp(36px, 4vw, 52px); font-weight: 600; letter-spacing: -0.02em; margin: 0 0 8px; background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
      .hero p { color: var(--text-secondary); margin: 8px 0 12px; }
      .tags { display: inline-flex; gap: 8px; margin-top: 6px; }
      .tag { background: rgba(99,102,241,0.12); color: var(--accent-color); border: 1px solid rgba(99,102,241,0.2); padding: 6px 12px; border-radius: 999px; font-size: 12px; }
      .split { display: grid; grid-template-columns: 1.05fr 0.95fr; gap: 24px; align-items: start; }
      .panel { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; overflow: hidden; }
      .panel-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid var(--border-color); color: var(--text-secondary); }
      .panel-title { font-weight: 600; color: var(--text-primary); }
      .panel-body { padding: 16px; }
      .input-section { display: grid; grid-template-columns: 1.3fr 1fr 1fr 1fr; gap: 12px; margin-bottom: 12px; }
      #course-topic-input { border: 1px solid var(--border-color); border-radius: 12px; padding: 12px 14px; font-size: 14px; color: var(--text-primary); background: rgba(255,255,255,0.03); outline: none; }
      #course-topic-input:focus { border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(99,102,241,0.25); }
      .select { border: 1px solid var(--border-color); border-radius: 12px; padding: 12px; font-size: 14px; color: var(--text-primary); background: rgba(255,255,255,0.03); }
      #generate-btn { border: none; background: var(--accent-gradient); color: #fff; border-radius: 12px; font-weight: 600; cursor: pointer; padding: 10px 22px; box-shadow: 0 10px 30px rgba(99,102,241,0.25); }
      #generate-btn:disabled { background: #93a3b8; cursor: not-allowed; opacity: .8; }
      #loader { text-align: center; padding: 20px; font-size: 14px; color: var(--text-secondary); opacity: 0; transition: opacity .25s ease; pointer-events: none; }
      #loader.is-visible { opacity: 1; pointer-events: auto; }
      .loading-wrap { display: inline-flex; align-items: center; gap: 12px; }
      .spinner { width: 22px; height: 22px; border: 3px solid rgba(255,255,255,0.25); border-top-color: var(--accent-color); border-radius: 50%; animation: spin 1s linear infinite; }
      @keyframes spin { to { transform: rotate(360deg); } }
      .dots { display: inline-flex; gap: 4px; }
      .dot { width: 6px; height: 6px; border-radius: 50%; background: rgba(255,255,255,0.25); animation: bounce 1.2s ease-in-out infinite; }
      .dot:nth-child(2) { animation-delay: .2s; }
      .dot:nth-child(3) { animation-delay: .4s; }
      @keyframes bounce { 0%,80%,100% { transform: translateY(0); opacity: .6; } 40% { transform: translateY(-6px); opacity: 1; } }
      #result-container { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 8px; display: none; }
      .actions { display: flex; gap: 10px; justify-content: flex-end; margin: 8px; }
      .btn { display: inline-flex; align-items: center; gap: 8px; border: 1px solid var(--border-color); border-radius: 10px; padding: 10px 14px; cursor: pointer; background: rgba(255,255,255,0.03); color: var(--text-primary); font-weight: 600; }
      .btn.primary { background: var(--accent-gradient); border-color: transparent; color: #fff; }
      .btn.light { background: rgba(255,255,255,0.08); }
      .result-section { margin-bottom: 22px; }
      .result-section h2 { font-size: 1.1em; color: var(--text-secondary); margin-bottom: 8px; }
      .title-card { background: rgba(255,255,255,0.03); border: 1px solid var(--border-color); border-radius: 14px; padding: 16px; }
      .module-card { background: rgba(255,255,255,0.03); border: 1px solid var(--border-color); border-radius: 14px; padding: 16px; margin-bottom: 14px; position: relative; }
      .badge { position: absolute; left: -8px; top: -8px; width: 28px; height: 28px; border-radius: 50%; background: var(--accent-gradient); color: #fff; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 12px; box-shadow: 0 6px 20px rgba(99,102,241,0.25); }
      .module-card h3 { font-size: 1.06em; margin: 2px 0 10px; color: var(--text-primary); }
      .module-card ul { padding-left: 18px; }
      .module-card li { margin-bottom: 8px; line-height: 1.7; color: var(--text-secondary); }
      .empty { text-align: center; color: var(--text-secondary); padding: 24px; border: 1px dashed var(--border-color); border-radius: 14px; background: rgba(255,255,255,0.03); }
      .error { border: 1px solid rgba(220,38,38,0.25); background: rgba(220,38,38,0.08); color: #fecaca; border-radius: 12px; padding: 12px 14px; margin-bottom: 12px; }
      .demo-banner { border: 1px solid rgba(245,158,11,0.3); background: rgba(245,158,11,0.12); color: #fde68a; border-radius: 12px; padding: 10px 12px; margin-bottom: 12px; }
      @media (max-width: 820px) { .split { grid-template-columns: 1fr; } #generate-btn { height: 44px; } .page { padding: 0 16px; margin: 80px auto 40px; } .input-section { grid-template-columns: 1fr; } }
      .settings-fab { position: fixed; right: 18px; bottom: 18px; z-index: 999; background: var(--accent-gradient); color: #fff; border: none; border-radius: 999px; padding: 10px 14px; box-shadow: 0 10px 30px rgba(99,102,241,0.25); cursor: pointer; }
      .modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; backdrop-filter: blur(6px); background: rgba(10,10,10,0.45); z-index: 1000; }
      .modal.open { display: flex; }
      .modal-card { width: 92%; max-width: 520px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 16px; color: var(--text-secondary); }
      .modal-card h3 { margin: 0 0 10px; color: var(--text-primary); }
      .modal-row { display: grid; gap: 8px; margin-bottom: 12px; }
      .modal-row input { border: 1px solid var(--border-color); border-radius: 12px; padding: 10px 12px; background: rgba(255,255,255,0.03); color: var(--text-primary); }
      .modal-actions { display: flex; gap: 10px; justify-content: flex-end; }
      .btn-secondary { border: 1px solid var(--border-color); background: rgba(255,255,255,0.08); color: var(--text-primary); border-radius: 10px; padding: 8px 12px; cursor: pointer; }
    </style>
</head>
<body class="has-navbar">
  <nav class="navbar" aria-label="主导航">
    <div class="nav-inner">
      <div class="brand">Darwin · AI Education</div>
      <button class="hamburger" aria-label="展开导航">
        <span></span><span></span><span></span>
      </button>
      <div class="links">
        <a href="/">首页</a>
        <a href="/thought/khanmigo_review.html">Khanmigo 深度剖析</a>
        <a href="/practice/index.html">苏格拉底机器人</a>
        <a href="/vision/portfolio/projects/course-gen/index.html">智能课程架构师</a>
      </div>
    </div>
  </nav>

    <main class="page">
      <section class="hero">
        <h1>智能课程架构师</h1>
        <p>输入主题，选择受众与时长，生成结构化课程大纲。</p>
        <div class="tags"><span class="tag">LLM</span><span class="tag">课程设计</span><span class="tag">生成式 AI</span></div>
      </section>
      <section class="split">
        <article class="panel control-window">
          <div class="panel-header"><span class="panel-title">参数设置</span></div>
          <div class="panel-body">
            <div class="input-section">
              <input type="text" id="course-topic-input" placeholder="输入课程主题，如：给10岁孩子讲量子力学">
              <select id="audience-select" class="select">
                <option value="primary">小学生</option>
                <option value="middle">初中生</option>
                <option value="high">高中生</option>
                <option value="college">大学生</option>
                <option value="adult">成人学习者</option>
              </select>
              <select id="duration-select" class="select">
                <option value="30">30 分钟</option>
                <option value="60" selected>60 分钟</option>
                <option value="90">90 分钟</option>
              </select>
              <select id="style-select" class="select">
                <option value="concept" selected>概念导向</option>
                <option value="practice">实践导向</option>
                <option value="discussion">讨论导向</option>
              </select>
            </div>
            <div style="display:flex;justify-content:flex-end;">
              <button id="generate-btn">生成大纲</button>
            </div>
          </div>
        </article>
        <article class="panel result-window">
          <div class="panel-header"><span class="panel-title">生成结果</span></div>
          <div class="panel-body">
            <section id="loader">
              <div class="loading-wrap">
                <div class="spinner" aria-hidden="true"></div>
                <div aria-live="polite" aria-busy="true">正在生成课程大纲 <span class="dots"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span></div>
              </div>
            </section>
            <section id="result-container"></section>
          </div>
        </article>
      </section>
    </main>
    <button class="settings-fab" id="open-settings">设置</button>
    <div class="modal" id="settings-modal" aria-hidden="true">
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="settings-title">
        <h3 id="settings-title">DeepSeek 设置</h3>
        <div class="modal-row">
          <label for="ds-base">API 基址</label>
          <input id="ds-base" type="text" placeholder="https://api.deepseek.com" />
        </div>
        <div class="modal-row">
          <label for="ds-key">API Key</label>
          <input id="ds-key" type="password" placeholder="以 sk- 开头的密钥" />
        </div>
        <div class="modal-actions">
          <button class="btn-secondary" id="close-settings">取消</button>
          <button class="btn primary" id="save-settings">保存</button>
        </div>
      </div>
    </div>
    
    <script>
      const burger = document.querySelector('.hamburger');
      const links = document.querySelector('.links');
      if (burger && links) burger.addEventListener('click', () => links.classList.toggle('open'));
      const topicInput = document.getElementById('course-topic-input');
      const audienceSelect = document.getElementById('audience-select');
      const durationSelect = document.getElementById('duration-select');
      const styleSelect = document.getElementById('style-select');
      const generateBtn = document.getElementById('generate-btn');
      const loader = document.getElementById('loader');
      const resultContainer = document.getElementById('result-container');
      const MOCK_MODE = location.protocol === 'file:';
      const openSettingsBtn = document.getElementById('open-settings');
      const settingsModal = document.getElementById('settings-modal');
      const saveSettingsBtn = document.getElementById('save-settings');
      const closeSettingsBtn = document.getElementById('close-settings');
      const dsBaseInput = document.getElementById('ds-base');
      const dsKeyInput = document.getElementById('ds-key');
      function getApiSettings(){ const base=localStorage.getItem('DEEPSEEK_BASE')||'https://api.deepseek.com'; const key=localStorage.getItem('DEEPSEEK_API_KEY')||''; return { base, key }; }
      function saveApiSettings(base,key){ if(base) localStorage.setItem('DEEPSEEK_BASE', base.trim()); if(key) localStorage.setItem('DEEPSEEK_API_KEY', key.trim()); }
      function openSettings(){ const s=getApiSettings(); dsBaseInput.value=s.base; dsKeyInput.value=s.key; settingsModal.classList.add('open'); settingsModal.setAttribute('aria-hidden','false'); }
      function closeSettings(){ settingsModal.classList.remove('open'); settingsModal.setAttribute('aria-hidden','true'); }
      if (openSettingsBtn) openSettingsBtn.addEventListener('click', openSettings);
      if (closeSettingsBtn) closeSettingsBtn.addEventListener('click', closeSettings);
      if (saveSettingsBtn) saveSettingsBtn.addEventListener('click', ()=>{ saveApiSettings(dsBaseInput.value, dsKeyInput.value); closeSettings(); });
      function setBusy(b) { generateBtn.disabled = b; topicInput.disabled = b; audienceSelect.disabled = b; durationSelect.disabled = b; styleSelect.disabled = b; }
      function showLoader(){ loader.classList.add('is-visible'); }
      function hideLoader(){ loader.classList.remove('is-visible'); }
      function clearResult(){ resultContainer.innerHTML=''; }
      function hideResult(){ resultContainer.style.display='none'; }
      function showResult(){ resultContainer.style.display='block'; }
      function toggleBtn(){ const empty = !(topicInput.value||'').trim(); generateBtn.disabled = empty; }
      function renderEmpty(){ clearResult(); const d=document.createElement('div'); d.className='empty'; d.innerHTML='请输入课程主题，并选择目标人群与课时长度后点击生成'; resultContainer.appendChild(d); showResult(); }
      function toMarkdown(data){ const { courseTitle, modules=[] } = data||{}; let md = `# ${courseTitle||'未命名课程'}\n\n`; modules.forEach((m,i)=>{ md += `## 模块 ${i+1}：${m.title||''}\n`; (m.points||[]).forEach(pt=>{ md += `- ${pt}\n`; }); md += `\n`; }); return md; }
      function copyText(t){ navigator.clipboard?.writeText(t).catch(()=>{}); }
      function exportMarkdown(t){ const blob = new Blob([t],{type:'text/markdown'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'course-outline.md'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }
      function renderActions(data){ const bar = document.createElement('div'); bar.className='actions'; const copyBtn = document.createElement('button'); copyBtn.className='btn light'; copyBtn.textContent='复制大纲'; const exportBtn = document.createElement('button'); exportBtn.className='btn light'; exportBtn.textContent='导出 Markdown'; const regenBtn = document.createElement('button'); regenBtn.className='btn primary'; regenBtn.textContent='重新生成'; bar.append(copyBtn, exportBtn, regenBtn); copyBtn.addEventListener('click',()=>copyText(toMarkdown(data))); exportBtn.addEventListener('click',()=>exportMarkdown(toMarkdown(data))); regenBtn.addEventListener('click', handleGenerate); resultContainer.appendChild(bar); }
      function saveState(payload, data){ try { localStorage.setItem('CourseGenState', JSON.stringify({ payload, data })); } catch(_){} }
      function loadState(){ try { const raw = localStorage.getItem('CourseGenState'); if(!raw) return null; const obj = JSON.parse(raw); if (obj && obj.payload && obj.data) return obj; } catch(_){} return null; }
      function renderTitle(title){ const sec = document.createElement('div'); sec.className='result-section'; const card = document.createElement('div'); card.className='title-card'; card.innerHTML = `<div style="font-size:14px;color:${getComputedStyle(document.documentElement).getPropertyValue('--muted')};margin-bottom:8px;">课程标题</div><div style="font-size:18px;font-weight:700;">${title||'未命名课程'}</div>`; sec.appendChild(card); resultContainer.appendChild(sec); }
      function renderModuleCard(m, idx){ const card = document.createElement('div'); card.className='module-card'; const badge = document.createElement('div'); badge.className='badge'; badge.textContent = idx+1; card.appendChild(badge); const title = document.createElement('h3'); title.textContent = m.title || `模块 ${idx+1}`; card.appendChild(title); const ul = document.createElement('ul'); (Array.isArray(m.points)?m.points:[]).forEach(pt=>{ const li=document.createElement('li'); li.textContent = pt; ul.appendChild(li); }); card.appendChild(ul); return card; }
      function renderModules(modules){ const sec = document.createElement('div'); sec.className='result-section'; const h = document.createElement('h2'); h.textContent = '课程模块'; sec.appendChild(h); modules.forEach((m,i)=>{ sec.appendChild(renderModuleCard(m,i)); }); resultContainer.appendChild(sec); }
      function renderDemoBanner(){ const b = document.createElement('div'); b.className = 'demo-banner'; b.textContent = '当前处于静态演示模式（后端未连接）。生成内容基于示例逻辑。'; resultContainer.prepend(b); }
      async function fetchCourseOutline(payload){ const resp = await fetch('/api/generate_course',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)}); if(!resp.ok) throw new Error('bad'); return await resp.json(); }
      async function deepseekCourseOutline(payload){ const { base, key } = getApiSettings(); if (!key) throw new Error('缺少 DeepSeek API Key'); const sys = '你是课程架构专家。根据输入生成 JSON：{"courseTitle":"...","modules":[{"title":"...","points":["...","..."]}]}，不要额外文字。'; const msgs = [ { role:'system', content: sys }, { role:'user', content: JSON.stringify(payload) } ]; const resp2 = await fetch(base.replace(/\/$/,'') + '/v1/chat/completions', { method:'POST', headers:{ 'Content-Type':'application/json', 'Authorization':'Bearer '+key }, body: JSON.stringify({ model:'deepseek-chat', messages: msgs }) }); if(!resp2.ok) throw new Error('DeepSeek 接口不可用: '+resp2.status); const data2 = await resp2.json(); let txt = data2.choices?.[0]?.message?.content || '{}'; try { return JSON.parse(txt); } catch (_) { return mockCourseOutline(payload); } }
      async function mockCourseOutline(payload){ const t = payload.topic; const a = payload.audience; const d = payload.duration; const s = payload.style; await new Promise(r=>setTimeout(r,900)); return { courseTitle: `${t}（${d}分钟，${a}，${s}风格）`, modules: [ { title: '破冰与目标设定', points: ['设定学习目标与期望','用贴近受众的例子进入主题','建立讨论规则'] }, { title: '核心概念拆解', points: ['用类比解释核心概念','引导提出自我定义','识别常见误区'] }, { title: '应用与练习', points: ['实践任务或案例分析','小组讨论与分享','形成迁移策略'] }, { title: '总结与延伸', points: ['要点回顾与自评','延伸阅读与作业','下次课程预告'] } ] }; }
      async function getCourseData(payload){ try { return await fetchCourseOutline(payload); } catch(e){ try { return await deepseekCourseOutline(payload); } catch(e2){ return await mockCourseOutline(payload); } } }
      function payload(){ return { topic: (topicInput.value||'').trim(), audience: audienceSelect.value, duration: durationSelect.value, style: styleSelect.value }; }
      async function handleGenerate(){ const p = payload(); if(!p.topic) return; setBusy(true); showLoader(); hideResult(); clearResult(); let data; try { data = await getCourseData(p); } catch(e){ const err = document.createElement('div'); err.className='error'; err.textContent='生成失败，请稍后重试'; resultContainer.appendChild(err); } hideLoader(); if(data){ renderActions(data); renderTitle(data.courseTitle); renderModules(data.modules||[]); showResult(); saveState(p, data); if(MOCK_MODE){ renderDemoBanner(); } } setBusy(false); topicInput.focus(); }
      generateBtn.addEventListener('click', handleGenerate);
      topicInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); handleGenerate(); }});
      topicInput.addEventListener('input', toggleBtn);
      toggleBtn();
      const restored = loadState();
      if (restored && restored.payload && restored.data){ topicInput.value = restored.payload.topic || ''; audienceSelect.value = restored.payload.audience || audienceSelect.value; durationSelect.value = restored.payload.duration || durationSelect.value; styleSelect.value = restored.payload.style || styleSelect.value; toggleBtn(); clearResult(); renderActions(restored.data); renderTitle(restored.data.courseTitle); renderModules(restored.data.modules||[]); showResult(); }
    </script>
    <script src="../assets/common.js"></script>
</body>
</html>
