# Android 注册测试指南

## 当前问题：HTTP 400 Bad Request

### 问题原因

HTTP 400 错误通常是因为：

1. **验证码已被使用** ⚠️ 最常见
   - 验证码验证成功后会立即从 Redis 删除
   - 如果多次点击注册按钮，第二次就会失败

2. **验证码过期**
   - 验证码有效期：5分钟
   - 超过5分钟后验证码会自动失效

3. **未先发送验证码**
   - 必须先点击"发送验证码"按钮
   - 然后才能注册

4. **手机号不匹配**
   - 注册时使用的手机号必须和发送验证码时的手机号一致

## 正确的注册流程 ✅

### 步骤详解

1. **打开注册界面**
   - 在登录界面点击"还没有账号？去注册"

2. **输入手机号**
   - 例如：`19353040215`（你刚才使用的）
   - 或：`13800138000`
   - 必须是11位数字，以1开头

3. **点击"发送验证码"按钮** ⚠️ 关键步骤
   - **只点击一次！**
   - 等待按钮变为倒计时状态（例如"59秒"）
   - 看到提示"验证码已发送"

4. **输入验证码**
   - Mock模式下，输入：`123456`
   - **注意**：每个手机号的验证码都是 `123456`

5. **输入密码**
   - 至少6位，最多50位字符
   - 例如：`password123`

6. **点击注册按钮**
   - **只点击一次！** ⚠️ 重要
   - 不要重复点击
   - 等待处理（可能需要几秒钟）

7. **成功后**
   - 会自动登录
   - 跳转到主界面

## 常见错误和解决方法

### 错误1：HTTP 400 Bad Request

**原因**：验证码验证失败

**解决方法**：
1. 确认已经点击"发送验证码"按钮
2. 确认验证码是 `123456`
3. 确认手机号和发送验证码时一致
4. **如果多次尝试失败，重新开始**：
   - 更换一个新的手机号
   - 重新发送验证码
   - 重新注册

### 错误2：HTTP 422 Unprocessable Entity

**原因**：输入格式不正确

**可能的问题**：
- 手机号不是11位
- 手机号不以1开头
- 验证码不是6位数字
- 密码少于6位或超过50位

**解决方法**：
- 检查输入格式
- 确保符合要求

### 错误3：手机号已注册

**原因**：该手机号已经注册过

**解决方法**：
- 使用另一个手机号注册
- 或者直接登录

## 推荐测试用例

### 测试用例1：全新注册
```
手机号：13800138000
步骤：
1. 点击"发送验证码"
2. 输入验证码：123456
3. 输入密码：password123
4. 点击"注册"（只点一次）
5. 等待跳转
```

### 测试用例2：使用你的手机号
```
手机号：19353040215
步骤：
1. 如果之前注册过，先尝试登录
2. 如果没注册过：
   - 点击"发送验证码"
   - 输入验证码：123456
   - 输入密码：password123
   - 点击"注册"（只点一次）
```

### 测试用例3：另一个新号码
```
手机号：13900139000
步骤：
1. 点击"发送验证码"
2. 输入验证码：123456
3. 输入密码：test123456
4. 点击"注册"（只点一次）
```

## 调试技巧

### 1. 查看 Android Logcat
在 Android Studio 中：
- 打开 Logcat 窗口
- 过滤：`ExamAI`
- 查看网络请求的详细信息
- 特别注意错误信息

### 2. 查看后端日志
```cmd
docker logs exam_assessment_backend_mock --tail 100
```

查找：
- `POST /api/v1/auth/send-code` - 发送验证码请求
- `POST /api/v1/auth/register` - 注册请求
- 状态码：200（成功）、400（验证失败）、422（格式错误）

### 3. 手动测试 API
```cmd
# 测试发送验证码
curl -X POST http://10.0.2.2:8000/api/v1/auth/send-code -H "Content-Type: application/json" -d "{\"phone\":\"13800138000\"}"

# 测试注册
curl -X POST http://10.0.2.2:8000/api/v1/auth/register -H "Content-Type: application/json" -d "{\"phone\":\"13800138000\",\"verification_code\":\"123456\",\"password\":\"password123\"}"
```

## 重要提示 ⚠️

1. **不要重复点击注册按钮**
   - 验证码验证成功后会被删除
   - 第二次点击会失败

2. **验证码有效期5分钟**
   - 超时后需要重新发送

3. **每次测试使用新手机号**
   - 避免"手机号已注册"错误
   - 或者使用已注册的手机号直接登录

4. **Mock 模式下所有验证码都是 123456**
   - 不需要真实的短信
   - 任何手机号都可以使用

## 成功标志

注册成功后你会看到：
1. ✅ 自动跳转到主界面
2. ✅ 显示三个功能按钮：
   - 拍摄试卷（实时指导）
   - 快速拍照
   - 历史记录
3. ✅ 可以开始使用应用

## 如果还是失败

请提供以下信息：

1. **操作步骤**
   - 详细说明你做了什么
   - 是否点击了"发送验证码"
   - 是否多次点击了"注册"

2. **错误截图**
   - Android 应用的错误提示
   - 完整的错误信息

3. **Logcat 日志**
   - 在 Android Studio 中导出
   - 或者截图相关部分

4. **后端日志**
   ```cmd
   docker logs exam_assessment_backend_mock --tail 200 > backend-log.txt
   ```

这样我可以更准确地帮你解决问题！
