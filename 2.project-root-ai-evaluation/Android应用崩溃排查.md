# Android 应用崩溃排查

## 问题现象

应用显示："AI试卷测评 keeps stopping"

## 可能的原因

### 1. 权限问题
- 相机权限未授予
- 存储权限未授予
- 网络权限问题

### 2. 网络配置问题
- 无法连接到后端 API (10.0.2.2:8000)
- 网络安全配置问题

### 3. 代码错误
- 空指针异常
- 类型转换错误
- 资源未找到

## 排查步骤

### 步骤1：查看 Logcat 日志

在 Android Studio 中：

1. 打开底部的 **Logcat** 窗口
2. 在搜索框输入：`ExamAI` 或 `AndroidRuntime`
3. 查找红色的错误信息
4. 特别注意包含以下关键词的行：
   - `FATAL EXCEPTION`
   - `Caused by:`
   - `Exception`
   - `Error`

### 步骤2：检查权限

应用需要以下权限：
- 相机权限
- 存储权限
- 网络权限

**检查方法**：
1. 在模拟器中，打开 **Settings（设置）**
2. 进入 **Apps（应用）**
3. 找到 **AI试卷测评**
4. 点击 **Permissions（权限）**
5. 确保以下权限已授予：
   - Camera（相机）
   - Storage（存储）

### 步骤3：检查网络连接

**测试后端连接**：
```cmd
# 在电脑上运行
curl http://localhost:8000/health
```

应该返回：
```json
{"status":"healthy","version":"1.0.0"}
```

### 步骤4：重新安装应用

1. 在模拟器中卸载应用
2. 在 Android Studio 中重新运行
3. 授予所有权限

## 常见错误和解决方法

### 错误1：NetworkOnMainThreadException

**原因**：在主线程执行网络请求

**解决**：代码应该已经使用协程处理，如果出现这个错误，需要检查代码

### 错误2：SecurityException: Permission denied

**原因**：权限未授予

**解决**：
1. 在模拟器中手动授予权限
2. 或者在应用启动时会弹出权限请求，点击"允许"

### 错误3：UnknownHostException

**原因**：无法连接到后端服务器

**解决**：
1. 确认后端服务正在运行
2. 确认 API 地址配置正确（10.0.2.2:8000）
3. 检查防火墙设置

### 错误4：NullPointerException

**原因**：代码中访问了空对象

**解决**：需要查看具体的堆栈跟踪来定位问题

## 获取详细日志

### 方法1：在 Android Studio 中

1. 打开 Logcat
2. 点击右上角的 **Export to File** 按钮
3. 保存日志文件
4. 把文件内容发给我

### 方法2：使用 ADB 命令

```cmd
adb logcat -d > android-crash-log.txt
```

## 临时解决方案

如果应用持续崩溃，可以尝试：

1. **清除应用数据**：
   - 设置 → 应用 → AI试卷测评 → 存储 → 清除数据

2. **重启模拟器**：
   - 关闭模拟器
   - 重新启动

3. **重新构建应用**：
   ```
   在 Android Studio 中：
   Build → Clean Project
   Build → Rebuild Project
   ```

## 下一步

请提供以下信息：

1. **Logcat 中的错误日志**（特别是红色的部分）
2. **崩溃发生的时机**：
   - 应用启动时？
   - 点击某个按钮时？
   - 选择图片时？

3. **之前的操作**：
   - 你点击了哪个按钮？
   - 做了什么操作？

有了这些信息，我可以准确定位问题并修复！
