# 下一步部署计划

## 当前状态 ✅

- ✅ 后端开发完成
- ✅ Android 应用开发完成
- ✅ 本地测试环境运行正常
- ✅ Mock 模式测试通过
- ✅ 注册登录功能正常
- ✅ 集成了阿里云 OCR
- ✅ 集成了 DeepSeek AI

## 下一步：生产环境部署

### 阶段1：准备工作（1-2天）

#### 1.1 服务器准备
- [ ] 购买云服务器（推荐：阿里云、腾讯云、AWS）
  - 配置建议：2核4G 起步
  - 操作系统：Ubuntu 20.04 LTS
  - 带宽：5M 起步
  - 存储：40GB SSD

- [ ] 域名准备
  - [ ] 购买域名（可选，但推荐）
  - [ ] 配置 DNS 解析
  - [ ] 申请 SSL 证书（HTTPS）

#### 1.2 环境配置
- [ ] 安装 Docker 和 Docker Compose
- [ ] 配置防火墙规则
- [ ] 配置安全组（开放必要端口）
  - 80 (HTTP)
  - 443 (HTTPS)
  - 22 (SSH，限制 IP)

#### 1.3 API 密钥确认
- [ ] 确认阿里云 OCR 密钥有效
- [ ] 确认 DeepSeek API 密钥有效
- [ ] 配置生产环境变量

### 阶段2：后端部署（1天）

#### 2.1 代码准备
- [ ] 清理测试代码和日志
- [ ] 更新配置文件
- [ ] 准备生产环境 Docker 镜像

#### 2.2 数据库部署
- [ ] 部署 PostgreSQL 数据库
- [ ] 配置数据库备份策略
- [ ] 初始化数据库表结构

#### 2.3 后端服务部署
- [ ] 上传代码到服务器
- [ ] 配置环境变量
- [ ] 启动 Docker 容器
- [ ] 配置 Nginx 反向代理
- [ ] 配置 SSL 证书

#### 2.4 测试验证
- [ ] 测试 API 健康检查
- [ ] 测试注册登录功能
- [ ] 测试 OCR 识别功能
- [ ] 测试 AI 评估功能

### 阶段3：Android 应用发布（2-3天）

#### 3.1 应用打包
- [ ] 更新 API 地址（改为生产环境域名）
- [ ] 生成签名密钥
- [ ] 打包 Release APK
- [ ] 测试 Release 版本

#### 3.2 应用商店准备
- [ ] 准备应用图标和截图
- [ ] 编写应用描述
- [ ] 准备隐私政策
- [ ] 准备用户协议

#### 3.3 发布渠道
**选项A：应用商店发布**
- [ ] Google Play Store（需要开发者账号，$25）
- [ ] 华为应用市场
- [ ] 小米应用商店
- [ ] OPPO 软件商店
- [ ] vivo 应用商店

**选项B：直接分发**
- [ ] 生成下载链接
- [ ] 创建下载页面
- [ ] 提供安装说明

### 阶段4：监控和维护（持续）

#### 4.1 监控系统
- [ ] 配置服务器监控
- [ ] 配置应用性能监控
- [ ] 配置日志收集
- [ ] 配置告警通知

#### 4.2 备份策略
- [ ] 数据库定期备份
- [ ] 文件存储备份
- [ ] 配置文件备份

#### 4.3 安全加固
- [ ] 配置 HTTPS
- [ ] 配置防火墙规则
- [ ] 定期更新系统补丁
- [ ] 配置访问限制

## 详细部署步骤

### 步骤1：服务器部署（推荐方案）

#### 使用 Docker Compose 部署

1. **连接到服务器**
   ```bash
   ssh root@your-server-ip
   ```

2. **安装 Docker**
   ```bash
   curl -fsSL https://get.docker.com | sh
   sudo systemctl start docker
   sudo systemctl enable docker
   ```

3. **上传项目文件**
   ```bash
   # 在本地电脑上
   scp -r backend root@your-server-ip:/opt/exam-ai/
   scp docker-compose.prod.yml root@your-server-ip:/opt/exam-ai/
   scp .env.production root@your-server-ip:/opt/exam-ai/.env
   ```

4. **启动服务**
   ```bash
   cd /opt/exam-ai
   docker-compose -f docker-compose.prod.yml up -d
   ```

5. **配置 Nginx**
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;
       
       location / {
           proxy_pass http://localhost:8000;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
   }
   ```

### 步骤2：Android 应用发布

#### 2.1 更新 API 地址

修改 `android/app/src/main/res/values/strings.xml`：
```xml
<string name="api_base_url">https://your-domain.com/</string>
```

#### 2.2 生成签名密钥

```bash
keytool -genkey -v -keystore exam-ai-release.jks -keyalg RSA -keysize 2048 -validity 10000 -alias exam-ai
```

#### 2.3 配置签名

在 `android/app/build.gradle.kts` 中添加：
```kotlin
android {
    signingConfigs {
        create("release") {
            storeFile = file("exam-ai-release.jks")
            storePassword = "your-password"
            keyAlias = "exam-ai"
            keyPassword = "your-password"
        }
    }
    
    buildTypes {
        release {
            signingConfig = signingConfigs.getByName("release")
        }
    }
}
```

#### 2.4 打包 APK

```bash
cd android
./gradlew assembleRelease
```

生成的 APK 位于：
```
android/app/build/outputs/apk/release/app-release.apk
```

## 成本估算

### 服务器成本（月付）
- **基础版**：阿里云 2核4G - ¥100-150/月
- **标准版**：阿里云 4核8G - ¥300-400/月
- **高级版**：阿里云 8核16G - ¥600-800/月

### API 成本（按量付费）
- **阿里云 OCR**：¥0.01-0.05/次
- **DeepSeek API**：¥0.001-0.01/次

### 域名和证书
- **域名**：¥50-100/年
- **SSL 证书**：免费（Let's Encrypt）或 ¥500-2000/年

### 应用商店
- **Google Play**：$25（一次性）
- **国内应用商店**：免费

## 时间线

### 快速部署（3-5天）
- Day 1：服务器准备和后端部署
- Day 2：测试和调试
- Day 3：Android 应用打包
- Day 4-5：应用发布和测试

### 完整部署（1-2周）
- Week 1：服务器部署、测试、优化
- Week 2：应用发布、监控配置、文档完善

## 推荐的部署方案

### 方案A：快速上线（适合测试和演示）
1. 使用阿里云轻量应用服务器
2. 使用 Docker Compose 一键部署
3. 使用免费 SSL 证书
4. APK 直接分发（不上架应用商店）

**优点**：快速、成本低
**缺点**：功能基础、扩展性有限

### 方案B：标准部署（适合正式运营）
1. 使用阿里云 ECS 服务器
2. 配置负载均衡和自动扩展
3. 使用 RDS 数据库服务
4. 上架主流应用商店

**优点**：稳定、可扩展、专业
**缺点**：成本较高、配置复杂

### 方案C：云原生部署（适合大规模）
1. 使用 Kubernetes 集群
2. 使用云数据库和对象存储
3. 配置 CDN 加速
4. 完整的监控和日志系统

**优点**：高可用、高性能、易扩展
**缺点**：成本高、技术要求高

## 我的建议

基于你的项目情况，我建议：

### 第一阶段：快速验证（1周）
1. 使用**方案A**快速部署
2. 邀请小范围用户测试
3. 收集反馈和数据
4. 验证商业模式

### 第二阶段：正式上线（2-4周）
1. 根据反馈优化功能
2. 升级到**方案B**
3. 上架应用商店
4. 开始推广运营

### 第三阶段：规模化（3-6个月）
1. 根据用户增长情况
2. 考虑升级到**方案C**
3. 增加更多功能
4. 扩展到更多平台

## 下一步行动

请告诉我你想：

1. **立即开始部署**
   - 我可以帮你准备部署脚本
   - 指导你完成服务器配置
   - 协助打包 Android 应用

2. **先了解更多细节**
   - 服务器选择和配置
   - 成本预算分析
   - 技术方案对比

3. **解决当前问题**
   - 修复 Android 应用崩溃
   - 完善功能测试
   - 优化性能

你想从哪里开始？
