# 调试注册问题 - 详细步骤

## 当前状态

✅ **后端服务已启动** - ProcessId: 2
✅ **已添加详细日志** - 可以看到验证码验证的详细过程

## 测试步骤

### 步骤1：在 Android 应用中测试注册

使用一个**全新的手机号**进行测试：

```
推荐手机号：18800188000
```

**完整流程**：
1. 打开注册界面
2. 输入手机号：`18800188000`
3. 点击"发送验证码"按钮
4. 等待倒计时开始（59秒、58秒...）
5. 输入验证码：`123456`
6. 输入密码：`test123456`
7. 点击"注册"按钮（**只点一次**）
8. 等待5秒

### 步骤2：立即查看后端日志

在你点击"注册"按钮后，**立即**在电脑上运行：

```cmd
docker logs exam_assessment_backend_mock --tail 50
```

## 你会看到的详细日志

### 如果验证码验证成功

你会看到类似这样的日志：

```
📝 注册请求 - 手机号: 18800188000, 验证码: 123456
🔍 验证码检查 - 手机号: 18800188000, 输入验证码: 123456, 存储的验证码: 123456
✅ 验证码验证成功 - 手机号: 18800188000
🔐 验证码验证结果: True
✅ 开始创建用户 - 手机号: 18800188000
🎉 用户创建成功 - user_id: xxx-xxx-xxx
POST /api/v1/auth/register HTTP/1.1" 200 OK
```

### 如果验证码不存在

你会看到：

```
📝 注册请求 - 手机号: 18800188000, 验证码: 123456
🔍 验证码检查 - 手机号: 18800188000, 输入验证码: 123456, 存储的验证码: None
❌ Redis中没有找到验证码 - 手机号: 18800188000, key: sms_code:18800188000
🔐 验证码验证结果: False
❌ 验证码验证失败 - 手机号: 18800188000
POST /api/v1/auth/register HTTP/1.1" 400 Bad Request
```

**这说明**：
- 验证码没有存储到 Redis
- 或者验证码已经被使用过
- 或者手机号不匹配

### 如果验证码不匹配

你会看到：

```
📝 注册请求 - 手机号: 18800188000, 验证码: 654321
🔍 验证码检查 - 手机号: 18800188000, 输入验证码: 654321, 存储的验证码: 123456
❌ 验证码不匹配 - 手机号: 18800188000, 期望: 123456, 实际: 654321
🔐 验证码验证结果: False
❌ 验证码验证失败 - 手机号: 18800188000
POST /api/v1/auth/register HTTP/1.1" 400 Bad Request
```

**这说明**：
- 输入的验证码不正确
- 应该输入 `123456`

### 如果手机号已注册

你会看到：

```
📝 注册请求 - 手机号: 18800188000, 验证码: 123456
🔍 验证码检查 - 手机号: 18800188000, 输入验证码: 123456, 存储的验证码: 123456
✅ 验证码验证成功 - 手机号: 18800188000
🔐 验证码验证结果: True
❌ 手机号已注册 - 手机号: 18800188000
POST /api/v1/auth/register HTTP/1.1" 400 Bad Request
```

**这说明**：
- 该手机号已经注册过了
- 可以直接登录
- 或者使用另一个手机号

## 常见问题诊断

### 问题1：验证码不存在（最常见）

**日志显示**：`存储的验证码: None`

**可能原因**：
1. 没有点击"发送验证码"按钮
2. 验证码已经被使用过（多次点击注册）
3. 验证码过期（超过5分钟）
4. 手机号输入错误（发送验证码和注册时不一致）

**解决方法**：
1. 确保先点击"发送验证码"
2. 只点击一次"注册"按钮
3. 5分钟内完成注册
4. 确保手机号一致

### 问题2：验证码不匹配

**日志显示**：`验证码不匹配 - 期望: 123456, 实际: xxx`

**可能原因**：
- 输入的验证码不是 `123456`

**解决方法**：
- Mock模式下，所有验证码都是 `123456`
- 确保输入正确

### 问题3：手机号已注册

**日志显示**：`手机号已注册`

**解决方法**：
- 使用该手机号直接登录
- 或者使用新的手机号注册

## 推荐的测试手机号

这些号码应该还没注册过：
- `18800188000`
- `17700177000`
- `16600166000`
- `15500155000`

## 完整测试流程

### 测试1：完整注册流程

```
1. 在 Android 应用中：
   - 输入手机号：18800188000
   - 点击"发送验证码"
   - 输入验证码：123456
   - 输入密码：test123456
   - 点击"注册"（只点一次）

2. 在电脑上立即运行：
   docker logs exam_assessment_backend_mock --tail 50

3. 查看日志，找到：
   - 📝 注册请求
   - 🔍 验证码检查
   - ✅ 或 ❌ 结果
```

### 测试2：验证发送验证码

```
1. 在 Android 应用中：
   - 输入手机号：18800188000
   - 点击"发送验证码"

2. 在电脑上运行：
   docker logs exam_assessment_backend_mock --tail 20

3. 应该看到：
   🎭 Using Mock SMS Service
   📱 Mock SMS: 发送验证码 123456 到 18800188000
   💡 提示：在开发模式下，所有手机号的验证码都是 123456
   POST /api/v1/auth/send-code HTTP/1.1" 200 OK
```

## 如果还是失败

请提供以下信息：

1. **你使用的手机号**
2. **后端日志**（运行上面的命令）
3. **Android Logcat 日志**（如果可以的话）
4. **具体的操作步骤**

这样我可以准确定位问题！

## 实时监控日志

如果你想实时查看日志，可以运行：

```cmd
docker logs -f exam_assessment_backend_mock
```

然后在 Android 应用中操作，你会实时看到日志输出。

按 `Ctrl+C` 停止监控。
