# 已知问题和解决方案

## 🔴 高优先级问题

### 1. Android 网络连接超时

**问题描述**:  
在 Android 设备上使用应用时，OCR 识别和 AI 分析可能出现"网络错误"或"请求超时"。

**影响范围**:  
- Android 应用
- 所有需要调用 Vercel API 的功能

**根本原因**:
1. Vercel Serverless Functions 冷启动时间较长（5-10 秒）
2. 移动网络速度限制
3. 图片 Base64 编码后体积较大（可能超过 1MB）
4. 某些网络环境可能阻止访问 Vercel

**已采取的措施**:
- ✅ 增加超时时间：15秒 → 30秒
- ✅ 增加重试次数：2次 → 3次
- ✅ 增加重试延迟：1秒 → 2秒
- ✅ 添加网络安全配置（`network_security_config.xml`）
- ✅ 添加详细错误日志

**临时解决方案**:
1. 使用更快的 WiFi 网络
2. 选择较小的图片（< 2MB）
3. 等待 Serverless Function 预热后再试

**长期解决方案**:
1. **使用专用服务器**: 替代 Vercel Serverless，减少冷启动时间
2. **图片压缩优化**: 在上传前进一步压缩图片
3. **添加离线模式**: 缓存常用数据，减少网络依赖
4. **使用 CDN**: 加速 API 响应
5. **实现队列系统**: 异步处理长时间任务

**优先级**: 🔴 高  
**预计修复时间**: 1-2 周

---

### 2. 首页底部按钮被截断

**问题描述**:  
在某些 Android 设备上，首页底部的两个数据卡片可能被截断或不完全显示。

**影响范围**:  
- Android 应用
- 首页仪表盘

**根本原因**:
- ScrollView 的 `minHeight: '100%'` 在某些设备上计算不正确
- 没有足够的底部 padding

**已采取的措施**:
- ✅ 添加 `ScrollView` 的 `contentContainerStyle`
- ✅ 设置 `paddingBottom: 40`
- ✅ 设置 `minHeight: 700`（固定高度）

**验证状态**: ⚠️ 需要在真实设备上测试

**长期解决方案**:
1. 使用 `SafeAreaView` 确保内容不被系统 UI 遮挡
2. 动态计算屏幕高度
3. 使用 `KeyboardAvoidingView` 处理键盘弹出

**优先级**: 🟡 中  
**预计修复时间**: 1-3 天

---

## 🟡 中优先级问题

### 3. 雷达图数据格式不匹配

**问题描述**:  
报告页面的雷达图显示 "Received NaN for the cx attribute" 错误。

**影响范围**:  
- Web 和 Android
- 报告页面雷达图

**根本原因**:
- `AnswerGrader.grade()` 返回的 `dimensionScores` 是数组，包含中文维度名
- `AbilityRadar` 组件期望对象格式，包含英文键名

**已采取的措施**:
- ✅ 在 `app/camera.tsx` 中添加数据转换逻辑
- ✅ 映射中文维度名到英文键名
- ✅ 计算百分比分数
- ✅ 提供默认值（60）
- ✅ 在 `AbilityRadar.tsx` 中添加 `|| 0` 保护

**验证状态**: ✅ 已在 Web 端验证通过

**优先级**: 🟡 中（已修复）  
**状态**: ✅ 已解决

---

### 4. 图片选择功能在 Android 上无响应

**问题描述**:  
点击"选择文件"按钮在 Android 上没有反应。

**影响范围**:  
- Android 应用
- 扫描终端页面

**根本原因**:
- 原代码只实现了 Web 端的文件选择（HTML `<input>`）
- Android 需要使用 `expo-image-picker`

**已采取的措施**:
- ✅ 安装 `expo-image-picker` 和 `expo-document-picker`
- ✅ 实现移动端文件选择函数 `handleMobileFileSelect`
- ✅ 更新 `camera.tsx` 支持移动端图片选择
- ✅ 更新 `ImageProcessor` 处理移动端 URI

**验证状态**: ✅ 已在构建中包含

**优先级**: 🟡 中（已修复）  
**状态**: ✅ 已解决

---

## 🟢 低优先级问题

### 5. 缺少加载骨架屏

**问题描述**:  
报告页面加载时没有骨架屏，用户体验不佳。

**影响范围**:  
- Web 和 Android
- 报告页面

**建议解决方案**:
1. 添加 `react-native-skeleton-placeholder`
2. 为每个报告组件创建骨架屏
3. 在数据加载时显示骨架屏

**优先级**: 🟢 低  
**预计修复时间**: 2-3 天

---

### 6. 没有错误边界

**问题描述**:  
应用崩溃时没有友好的错误提示。

**影响范围**:  
- Web 和 Android
- 所有页面

**建议解决方案**:
1. 实现 React Error Boundary
2. 添加全局错误处理
3. 显示友好的错误页面

**优先级**: 🟢 低  
**预计修复时间**: 1-2 天

---

### 7. 缺少单元测试

**问题描述**:  
项目缺少单元测试和集成测试。

**影响范围**:  
- 代码质量
- 维护性

**建议解决方案**:
1. 使用 Jest 编写单元测试
2. 使用 React Native Testing Library 测试组件
3. 使用 fast-check 编写属性测试
4. 目标覆盖率：80%+

**优先级**: 🟢 低  
**预计修复时间**: 1-2 周

---

## 📋 待验证问题

### 8. 历史记录功能

**状态**: ⚠️ 未充分测试  
**需要验证**:
- 报告保存是否正常
- 报告列表是否正确显示
- 点击报告是否能正确跳转

---

### 9. 分享功能

**状态**: ⚠️ 未在真实设备测试  
**需要验证**:
- Android 分享是否正常工作
- 分享内容是否正确

---

### 10. 相机功能

**状态**: ⚠️ 未在真实设备测试  
**需要验证**:
- 相机权限请求是否正常
- 拍照功能是否正常
- 图片质量是否满足 OCR 要求

---

## 🔧 性能问题

### 11. 包体积较大

**问题描述**:  
APK 文件可能较大（预计 30-50MB）。

**原因**:
- 包含多个图表库
- 包含 Expo SDK
- 包含所有依赖

**建议优化**:
1. 使用 Hermes 引擎
2. 启用代码分割
3. 移除未使用的依赖
4. 优化图片资源

**优先级**: 🟢 低  
**预计优化时间**: 3-5 天

---

## 📝 文档问题

### 12. 缺少 API 文档

**问题描述**:  
后端 API 缺少详细的接口文档。

**建议**:
1. 使用 Swagger/OpenAPI 生成文档
2. 添加请求/响应示例
3. 说明错误码

**优先级**: 🟢 低

---

### 13. 缺少用户手册

**问题描述**:  
缺少面向最终用户的使用手册。

**建议**:
1. 创建图文教程
2. 录制演示视频
3. 添加常见问题解答

**优先级**: 🟢 低

---

## 🎯 问题优先级说明

- 🔴 **高优先级**: 影响核心功能，需要立即修复
- 🟡 **中优先级**: 影响用户体验，应尽快修复
- 🟢 **低优先级**: 不影响使用，可以延后修复

---

**最后更新**: 2026-01-19  
**文档版本**: 1.0.0
