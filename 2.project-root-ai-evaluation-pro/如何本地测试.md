# 本地测试指南

## 快速启动

### 方法 1：使用启动脚本（推荐）

1. 双击运行 `start-local-dev.bat`
2. 会自动打开两个命令行窗口：
   - 本地 API 服务器（端口 3001）
   - Expo 开发服务器（端口 8081）
3. 等待 Expo 启动完成后，在浏览器中访问显示的 URL（通常是 http://localhost:8081）

### 方法 2：手动启动

**重要：必须在项目目录下运行命令！**

项目目录：`D:\桌面文件\project-root\2.project-root-ai-evaluation-pro`

#### 步骤 1：启动本地 API 服务器

打开第一个命令行窗口：

```cmd
cd /d D:\桌面文件\project-root\2.project-root-ai-evaluation-pro
node local-api-server.js
```

你应该看到：
```
✓ 本地 API 服务器运行在 http://localhost:3001
✓ OCR 端点: http://localhost:3001/api/ocr
```

#### 步骤 2：启动 Expo 开发服务器

打开第二个命令行窗口：

```cmd
cd /d D:\桌面文件\project-root\2.project-root-ai-evaluation-pro
npx expo start --web
```

等待启动完成，然后在浏览器中访问显示的 URL。

## 测试流程

1. 在浏览器中打开应用
2. 点击"启动视觉诊断"
3. 选择一张答题卡图片
4. 点击"开始扫描"
5. 等待处理完成（会显示 6 个步骤的进度）
6. 自动跳转到报告页面

## 常见问题

### 问题 1：命令找不到文件

**错误信息：**
```
Error: Cannot find module 'C:\Users\WIN10\local-api-server.js'
```

**原因：** 你在错误的目录下运行命令

**解决方法：** 使用 `cd /d D:\桌面文件\project-root\2.project-root-ai-evaluation-pro` 切换到项目目录

### 问题 2：Expo 找不到项目

**错误信息：**
```
ConfigError: Cannot determine the project's Expo SDK version
```

**原因：** 你在错误的目录下运行 npx expo start

**解决方法：** 确保在项目目录下运行命令

### 问题 3：端口被占用

**错误信息：**
```
Error: listen EADDRINUSE: address already in use :::3001
```

**解决方法：** 
1. 关闭之前运行的服务器
2. 或者修改 `local-api-server.js` 中的端口号

### 问题 4：识别超时

**原因：** 本地网络无法访问阿里云 OCR API

**当前方案：** 使用模拟数据进行测试（已在 `local-api-server.js` 中配置）

## 注意事项

1. **必须同时运行两个服务器**：
   - 本地 API 服务器（3001 端口）
   - Expo 开发服务器（8081 端口）

2. **本地测试使用模拟数据**：
   - OCR 返回固定的答案字符串
   - 这是因为本地网络无法访问阿里云 API
   - 生产环境会使用真实的 API

3. **开发环境配置**：
   - `lib/ApiClient.ts` 中配置了开发环境使用 `http://localhost:3001/api`
   - 生产环境使用 `https://somegood.vercel.app/api`

## 下一步

本地测试通过后，可以部署到 Vercel：

```cmd
npm run deploy
```

或者手动部署：

```cmd
vercel --prod
```
